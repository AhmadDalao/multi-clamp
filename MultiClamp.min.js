"use strict";!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.MultiClamp=t.MultiClamp||e()}(this,function(){function o(t){return parseInt(t,10)}function s(t){return(t+"").replace(/[^\d.]/g,"")-0}function r(t,e){return t.textContent?t.textContent=e:t.innerText=e}function p(t){return t.textContent?t.textContent:t.innerText}function l(t,e){return window.getComputedStyle?window.getComputedStyle(t,null).getPropertyValue(e):t.currentStyle.getAttribute(e.replace(/-(\w)/g,function(t,e){return e.toUpperCase()}))}function h(t){var e=l(t,"height");return-1<e.indexOf("px")?s(e):s(t.clientHeight)-s(l(t,"padding-top"))-s(l(t,"padding-bottom"))}var t=function(t,e){if(t){this.element=t.length?t[0]:t;var i=e||{};if(this.option={ellipsis:"ellipsis"in i?i.ellipsis:"...",clamp:"clamp"in i?i.clamp:3,reverse:"reverse"in i&&!!i.reverse,splitByWords:"splitByWords"in i&&!!i.splitByWords,disableCssClamp:"disableCssClamp"in i&&!!i.disableCssClamp},"lineTextLen"in i&&(this.option.lineTextLen=i.lineTextLen),"auto"===this.option.clamp)this.autoClamp=!0;else{if(this.option.clamp=o(this.option.clamp),isNaN(this.option.clamp)||this.option.clamp<1)throw new Error("Invaild clamp number!");this.autoClamp=!1}this.useCssClamp=!(this.option.disableCssClamp||this.autoClamp||this.option.reverse||this.option.splitByWords||"..."!==this.option.ellipsis||void 0===document.body.style.webkitLineClamp),this.init(),this.clamp()}};return t.prototype={constructor:t,reload:function(){this.init(),this.clamp()},init:function(){if(this.useCssClamp){var t={display:"-webkit-box",overflow:"hidden",textOverflow:"ellipsis",WebkitLineClamp:this.option.clamp,WebkitBoxOrient:"vertical"};for(var e in t)this.element.style[e]=t[e]}else this.ellipsis=document.createElement("span"),this.ellipsis.style.display="none",this.ellipsis.innerHTML=this.option.ellipsis,this.content=document.createElement("span"),this.wrapper=document.createElement("div"),r(this.content,p(this.element)),this.element.innerHTML="",this.element.appendChild(this.wrapper),this.option.reverse?(this.wrapper.appendChild(this.ellipsis),this.wrapper.appendChild(this.content)):(this.wrapper.appendChild(this.content),this.wrapper.appendChild(this.ellipsis))},getSingleLineHeight:function(){var t=l(this.wrapper,"line-height"),i=this;if(-1<t.indexOf("px"))return s(t);if(isNaN(t))return n();var e=l(this.wrapper,"font-size");return-1<e.indexOf("px")?s(e)*(100*t)/100:-1<e.indexOf("pt")?400*s(e)/300*(100*t)/100:n();function n(){var t=p(i.content);r(i.content,".");var e=h(i.wrapper);return r(i.content,t),e}},clamp:function(){if(!this.useCssClamp){var t,e=p(this.content),i=h(this.wrapper),n=this.getSingleLineHeight();if(""!==e&&i&&n)if(this.autoClamp?(t=h(this.element),this.option.clamp=o(t/n)):t=n*this.option.clamp,t)if(t<i){this.ellipsis.style.display="";var s=this.option.splitByWords?e.match(/\w+|\W+?/g):e,l=(this.option.lineTextLen||Math.min(20,e.length/this.option.clamp))*this.option.clamp;this.trunkSlice(s,t,l,0,!1)}else this.element.innerHTML=p(this.content)}},trunkSlice:function(t,e,i,n,s){var l,p=this.option.reverse?t.slice(t.length-n):t.slice(0,n);if(r(this.content,this.option.splitByWords?p.join(""):p),h(this.wrapper)>e)l=s?i:o(i/2)||1,this.trunkSlice(t,e,l,n-l,!0);else{if(1===i&&s)return this.option.splitByWords&&/\s/.test(p[this.option.reverse?0:p.length-1])&&r(this.content,(this.option.reverse?p.slice(1):p.slice(0,p.length-1)).join("")),void this.clean();l=s?o(i/2)||1:i,this.trunkSlice(t,e,l,n+l,!1)}},clean:function(){this.option.reverse?this.element.innerHTML=this.ellipsis.innerHTML+p(this.content):this.element.innerHTML=p(this.content)+this.ellipsis.innerHTML,this.wrapper=null,this.ellipsis=null,this.content=null,delete this.wrapper,delete this.ellipsis,delete this.content}},t});